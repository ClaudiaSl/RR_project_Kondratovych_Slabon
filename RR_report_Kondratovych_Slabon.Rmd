---
title: "RR_report_Kondratovych_Slabon"
author: "Claudia Słaboń, Kateryna Kondratovych"
date: "5/6/2021"
output:
html_document: default
---

```{r libraries, include=FALSE}
library(ggplot2)
library(ggthemes)
library(tibble)
library(lubridate)
library(dplyr)
library(ggpubr)
library(reshape)
library(scales)
library(plotly)
library(maps)
library(gganimate)
library(zoo)
library(tidyr)
library(xts)
library(dygraphs)
library(RColorBrewer)
library(rgdal)
library(sf)
library(readxl)
library(viridis)
library(cowplot)
library(forecast)
```

## COVID-19 and it’s impact on unemployment rate

The first cases of COVID-19 comes from China (Wuhan) and were discovered in November 2019. From the beginning of the 2020 new outbreaks of the coronavirus have started to appear in other countries. The pandemic spread around the world rapidly. The discovery of the easily contagious virus forced on the world's government to take an fast and unconventional actions. Many countries have closed their borders and introduced lockdown. Due to such actions many economies suffer from a pandemic. \
The aim of this project is to discover whether the COVID-19 had an impact on unemployment in 2020. Firsly, it will be examined from the point of view of OECD countries, G7 countries, the USA. After that, the situation in Poland will be discussed.

Dataset sources: \
- Daily coronavirus dataset comes from Johns Hopkins Coronavirus Resource Center. \
- Monthly unemployment rate in OECD countries comes from the OECD website. \
- Poland unemployment rate in voivodships comes from Poland's Central Statistical Office. \
- Poland map was built from dataset introduced during the classes. \

```{r datasets, echo=FALSE, results='hide'}
data_covid <- read.csv("Dane/covid-19-all.csv")
data_unemp <- read.csv("Dane/DP_LIVE_27012021180248760.csv")
PL_sex <- read.csv('Dane/MW.csv')
PL_edu <- read.csv('Dane/Pledu.csv',stringsAsFactors = FALSE)
PL_age <- read.csv('Dane/Pl_age.csv')
PL_woj <- read.csv('Dane/PL_wojew.csv')
PL_unemp <- read.csv('Dane/PL_unemp.csv')
woj_pl <- st_read('Dane/Województwa.shp')
my_data <- read_excel("Dane/wlis1.xlsx")
```

```{r changing, echo=FALSE, results='hide'}
data_covid$Date <- as.Date(data_covid$Date, format = "%Y-%m-%d")
data <- data_covid %>%
  filter(Date < as.Date("2021-01-01"))
summary(data)
data_agg <- aggregate(cbind(Confirmed, Recovered, Deaths)~week(Date)+Country.Region+Latitude+Longitude,
          data=data,FUN=max)
data_agg$`week(Date)` <- as.numeric(data_agg$`week(Date)`)
data_agg2 <- aggregate(cbind(Confirmed, Recovered, Deaths)~week(Date)+Country.Region,
                      data=data,FUN=max)
```

# Unemployment rate in OECD countries

The below graphs present the situation of unemployment rate in OECD countries. It means that the unemployment rate is captured in 37 countries.

```{r oecd, echo=FALSE, fig.align='center', results='hide', message = FALSE}
colnames(data_unemp)[1] <- "Country"
plot_unemp19 <- data_unemp %>%
  filter(TIME == '2019-09' & Country != "EU28" & Country != "EA19" & Country != "EU27_2020")%>%
  select(Country, Value) %>%
  arrange(desc(Value)) %>%
  top_n(15) %>%
  arrange(Value) %>%
  mutate(Country = factor(Country, levels = .$Country)) %>%
  ggplot(aes(x=Country, y=Value)) +
  geom_segment( aes(x=Country, xend=Country, y=0, yend=Value), color="black") +
  scale_y_continuous(labels=function(x) paste0(x,"%")) +
  geom_point( color="skyblue", size=4) +
  theme_light() +
  coord_flip() +
  labs(title="Highest unemployment rate in 09/2019")+
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    plot.title = element_text(hjust = 0.5))
plot_unemp20 <- 
 data_unemp %>%
  filter(TIME == "2020-09" & Country != "EU28" & Country != "EA19" & Country != "EU27_2020" & Country != "OECD")%>%
  select(Country, Value) %>%
  arrange(desc(Value)) %>%
  top_n(15) %>%
  arrange(Value) %>%
  mutate(Country = factor(Country, levels = .$Country)) %>%
  ggplot(aes(x=Country, y=Value)) +
  geom_segment( aes(x=Country, xend=Country, y=0, yend=Value), color="black") +
  scale_y_continuous(labels=function(x) paste0(x,"%")) +
  geom_point( color="skyblue", size=4) +
  theme_light() +
  coord_flip() +
  labs(title="Highest unemployment rate in 09/2020")+
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    plot.title = element_text(hjust = 0.5))
plot_unem_1920_diff <- data_unemp %>%
  filter(TIME == "2019-09" | TIME == "2020-09") %>%
  select(Country,TIME, Value) %>%
  cast(Country~TIME) %>%
  filter(Country != "G-7" & Country != "EU28" & Country != "EA19" & Country != "EU27_2020" & Country != "OECD") %>%
  mutate(diff=`2020-09` - `2019-09`) %>%
  arrange(desc(diff)) %>%
  mutate(Country = factor(Country, levels = .$Country)) %>%
  top_n(15) %>%
  ggplot(aes(x = factor(Country), y = diff)) +
  geom_bar(na.rm = TRUE, width = 0.7, stat = "identity", aes(fill = diff))+
  expand_limits(y = c(0, 6.5)) +
  geom_text(aes(label = paste0(round(diff,1),"%")), vjust=-0.25, size =3) +
  scale_y_continuous(labels=function(x) paste0(x,"%")) +
  scale_fill_gradient2(low='lightblue', mid='lightblue', high='#1167b1') +
  labs(title = "The greatest change in unemployment rate between 09/2019 and 09/2020",
       caption = "Data comes from OECD which monitores unemployment in 37 countries.") +
  theme(legend.title = element_blank(),
        legend.position = "none",
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
ggarrange(ggarrange(plot_unemp19, plot_unemp20, ncol = 2),
          plot_unem_1920_diff, 
          nrow = 2)
```
# COVID-19 spread during 2020

```{r worldmap, echo=FALSE, fig.align='center'}

world <- ggplot() +
  borders("world", colour = "gray85", fill = "gray80") +
  theme_map()
map <- world +
  geom_point(aes(x = Longitude, y = Latitude, size = Confirmed), data = data_agg, colour = '#FF8484', alpha = .5) +
  scale_size_continuous(range =  c(1, 6), 
                        breaks = c(250, 500, 1000, 10000, 100000, 1000000),
                        labels = c("250", "500", "1 000", "10 000", "100 000", "1M")) +
  labs(title = 'COVID-19 spread in 2020',
       subtitle = 'Week number: {closest_state}',
       size = 'Confirmed cases') + 
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size =15),
        plot.subtitle = element_text(hjust = 0.5, face = "bold", size =12),
        legend.title = element_text(size=12),
        legend.text=element_text(size=12),
        legend.position = c(0, 0.2),
        legend.background = element_rect(fill="white",
                                         size=0.5, linetype="solid", 
                                         colour ="black")) +
  transition_states(`week(Date)`, wrap = FALSE) +
  shadow_mark(past=T) +
  enter_fade() 

animate(map)

```

The map shows the spread of the coronavirus during 2020 (from the 4th week to the end of the year). From the map one can observe that although, the first cases were discover in China, the pandemic rapidly spread around the whole world. Currently, there is 107 270 821 coronavirus cases, 2 345 078 people died and 79 117 673 recovered (02/09/2021 update). \
Official top 3 countries with highest COVID-19 cases number: \
- the USA (27 755 037 cases), \
- India (10 858 300 cases), \
- Brazil (9 560 362 cases). \